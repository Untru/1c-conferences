name: üóÇÔ∏è –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

on:
  push:
    branches: [ main, master ]
    paths:
      - 'docs/events/**/*.md'
      - 'docs/events/**/index.md'
      - '.github/workflows/auto-nav.yml'
      - 'generate_nav.py'
  pull_request:
    branches: [ main, master ]
    paths:
      - 'docs/events/**/*.md'
      - 'docs/events/**/index.md'
      - '.github/workflows/auto-nav.yml'
      - 'generate_nav.py'
  workflow_dispatch: # –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –≤—Ä—É—á–Ω—É—é

jobs:
  update-navigation:
    name: üîÑ –û–±–Ω–æ–≤–∏—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏—é
    runs-on: ubuntu-latest
    
    steps:
      - name: üì• –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–¥
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0

      - name: üêç –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: üì¶ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: üóÇÔ∏è –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏—é
        run: |
          python generate_nav.py

      - name: üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
        id: check-changes
        run: |
          if [ -n "$(git status --porcelain)" ]; then
            echo "changes=true" >> $GITHUB_OUTPUT
            echo "üìù –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏"
            git status
          else
            echo "changes=false" >> $GITHUB_OUTPUT
            echo "‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏–π –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ"
          fi

      - name: üìù –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
        if: steps.check-changes.outputs.changes == 'true'
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add mkdocs.yml
          git commit -m "üóÇÔ∏è –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ [skip ci]"
          git push

      - name: ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ
        run: |
          echo "üéâ –ù–∞–≤–∏–≥–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞!"
          echo "üìã –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:"
          git diff --name-only HEAD~1 HEAD || echo "–ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π"
