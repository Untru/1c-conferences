name: üóÇÔ∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

on:
  pull_request:
    branches: [ main, master ]
    paths:
      - 'docs/events/**/*.md'
      - 'docs/events/**/index.md'
      - '.github/workflows/auto-nav.yml'
      - 'generate_nav.py'
  workflow_dispatch: # –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –≤—Ä—É—á–Ω—É—é

jobs:
  check-navigation:
    name: üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏—é
    runs-on: ubuntu-latest
    
    steps:
      - name: üì• –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–¥
        uses: actions/checkout@v4

      - name: üêç –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: üì¶ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: üóÇÔ∏è –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏—é
        run: |
          python generate_nav.py

      - name: üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
        id: check-changes
        run: |
          if [ -n "$(git status --porcelain mkdocs.yml)" ]; then
            echo "changes=true" >> $GITHUB_OUTPUT
            echo "üìù –ù–∞–≤–∏–≥–∞—Ü–∏—è —Ç—Ä–µ–±—É–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è"
            echo "üîç –ò–∑–º–µ–Ω–µ–Ω–∏—è:"
            git diff mkdocs.yml
          else
            echo "changes=false" >> $GITHUB_OUTPUT
            echo "‚úÖ –ù–∞–≤–∏–≥–∞—Ü–∏—è –∞–∫—Ç—É–∞–ª—å–Ω–∞"
          fi

      - name: üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤ PR
        if: steps.check-changes.outputs.changes == 'true' && github.event_name == 'pull_request'
        uses: actions/github-script@v6
        with:
          script: |
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: 'üóÇÔ∏è **–ù–∞–≤–∏–≥–∞—Ü–∏—è –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∞** –ø—Ä–∏ –º–µ—Ä–∂–µ —ç—Ç–æ–≥–æ PR!\n\n‚ú® –ù–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏—é —Å–∞–π—Ç–∞.'
            })

      - name: ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ
        run: |
          echo "üéâ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
          if [ "${{ steps.check-changes.outputs.changes }}" == "true" ]; then
            echo "üìù –ù–∞–≤–∏–≥–∞—Ü–∏—è –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –ø—Ä–∏ –¥–µ–ø–ª–æ–µ"
          else
            echo "‚úÖ –ù–∞–≤–∏–≥–∞—Ü–∏—è —É–∂–µ –∞–∫—Ç—É–∞–ª—å–Ω–∞"
          fi
